<!doctype html>
<html lang="id">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Voice Verification with Chat</title>

        <!-- Google Fonts - Inter (Professional) -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
            rel="stylesheet" />

        <style>
            * {
                box-sizing: border-box;
                font-family:
                    "Inter",
                    -apple-system,
                    BlinkMacSystemFont,
                    "Segoe UI",
                    system-ui,
                    sans-serif;
            }

            body {
                background: #ffffff;
                min-height: 100vh;
                margin: 0;
                padding: 20px;
                color: #1a1a1a;
            }

            .container {
                display: flex;
                gap: 24px;
                max-width: 1400px;
                margin: 0 auto;
                height: calc(100vh - 40px);
            }

            /* Control Panel (Sidebar) */
            .control-panel {
                background: #ffffff;
                border: 1px solid #e5e5e5;
                border-radius: 12px;
                width: 380px;
                padding: 24px;
                display: flex;
                flex-direction: column;
                gap: 24px;
                overflow-y: auto;
            }

            h2 {
                margin: 0;
                font-size: 1rem;
                font-weight: 600;
                letter-spacing: -0.01em;
            }

            /* Chat Container */
            .chat-container {
                flex: 1;
                background: #fcfcfc;
                border: 1px solid #e5e5e5;
                border-radius: 12px;
                display: flex;
                flex-direction: column;
                overflow: hidden;
            }

            .chat-header {
                padding: 20px 24px;
                border-bottom: 1px solid #e5e5e5;
                display: flex;
                align-items: center;
                gap: 12px;
                background: #ffffff;
            }

            .chat-header h2 {
                font-size: 1rem;
                font-weight: 600;
            }

            .status-indicator {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background: #d1d5db;
                transition: all 0.3s;
            }

            .status-indicator.active {
                background: #000000;
                box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.05);
            }

            /* Chat Messages - LAYOUT BARU */
            .chat-messages {
                flex: 1;
                overflow-y: auto;
                padding: 24px;
                display: flex;
                flex-direction: column;
                gap: 16px;
            }

            .message {
                display: flex;
                gap: 12px;
                animation: fadeIn 0.3s ease-in;
                max-width: 80%;
            }

            /* AI Message - KIRI */
            .message.assistant {
                align-self: flex-start;
                flex-direction: row;
            }

            /* User Message - KANAN */
            .message.user {
                align-self: flex-end;
                flex-direction: row-reverse;
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .message-avatar {
                width: 36px;
                height: 36px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1rem;
                flex-shrink: 0;
            }

            .user-avatar {
                background: #000000;
                color: #ffffff;
            }

            .assistant-avatar {
                background: #f3f4f6;
                border: 1px solid #e5e5e5;
                color: #000000;
            }

            .message-content {
                flex: 1;
                display: flex;
                flex-direction: column;
                gap: 4px;
            }

            /* User message - align kanan */
            .message.user .message-content {
                align-items: flex-end;
            }

            /* AI message - align kiri */
            .message.assistant .message-content {
                align-items: flex-start;
            }

            .message-role {
                font-size: 0.7rem;
                font-weight: 600;
                text-transform: uppercase;
                letter-spacing: 0.05em;
                color: #737373;
                margin-bottom: 4px;
            }

            .message-bubble {
                padding: 12px 16px;
                border-radius: 16px;
                max-width: 100%;
                word-wrap: break-word;
            }

            /* User bubble - hitam */
            .message.user .message-bubble {
                background: #000000;
                color: #ffffff;
                border-bottom-right-radius: 4px;
            }

            /* AI bubble - abu-abu terang */
            .message.assistant .message-bubble {
                background: #f3f4f6;
                color: #1a1a1a;
                border: 1px solid #e5e5e5;
                border-bottom-left-radius: 4px;
            }

            .message-text {
                line-height: 1.5;
                font-size: 0.95rem;
                font-weight: 400;
            }

            .message-timestamp {
                font-size: 0.7rem;
                color: #a3a3a3;
                margin-top: 4px;
            }

            /* Typing Indicator */
            .typing-message {
                align-self: flex-start;
                max-width: 80%;
            }

            .typing-indicator {
                display: flex;
                gap: 4px;
                padding: 12px 16px;
            }

            .typing-dot {
                width: 6px;
                height: 6px;
                border-radius: 50%;
                background: #9ca3af;
                animation: typing 1.4s infinite;
            }

            .typing-dot:nth-child(2) {
                animation-delay: 0.2s;
            }

            .typing-dot:nth-child(3) {
                animation-delay: 0.4s;
            }

            @keyframes typing {
                0%,
                60%,
                100% {
                    opacity: 0.3;
                    transform: translateY(0);
                }
                30% {
                    opacity: 1;
                    transform: translateY(-4px);
                }
            }

            /* Empty State */
            .empty-state {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 100%;
                color: #a3a3a3;
                text-align: center;
                padding: 40px;
            }

            .empty-state-icon {
                font-size: 3rem;
                margin-bottom: 16px;
                opacity: 0.5;
            }

            .empty-state-text {
                font-size: 1rem;
                font-weight: 500;
                margin-bottom: 8px;
                color: #525252;
            }

            .empty-state-subtext {
                font-size: 0.85rem;
                color: #a3a3a3;
            }

            /* Control Panel Elements */
            .section {
                display: flex;
                flex-direction: column;
                gap: 8px;
            }

            .section-title {
                font-size: 0.8rem;
                font-weight: 600;
                color: #737373;
                text-transform: uppercase;
                letter-spacing: 0.05em;
                margin-bottom: 4px;
            }

            .btn-group {
                display: flex;
                gap: 10px;
            }

            input[type="email"],
            input[type="password"] {
                width: 100%;
                padding: 12px;
                border-radius: 8px;
                border: 1px solid #e5e5e5;
                background: #ffffff;
                color: #1a1a1a;
                margin-bottom: 12px;
                transition: border-color 0.2s;
                font-size: 0.95rem;
            }

            input:focus {
                outline: none;
                border-color: #000000;
            }

            button {
                flex: 1;
                padding: 12px;
                border-radius: 8px;
                border: 1px solid #e5e5e5;
                cursor: pointer;
                font-weight: 600;
                background: #ffffff;
                color: #1a1a1a;
                transition: all 0.2s;
                font-size: 0.9rem;
            }

            button:hover:not(:disabled) {
                background: #f9fafb;
                border-color: #a3a3a3;
            }

            button:active:not(:disabled) {
                transform: scale(0.98);
            }

            button:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

            .primary {
                background: #000000 !important;
                color: #ffffff !important;
                border: none;
            }

            .primary:hover:not(:disabled) {
                background: #262626 !important;
            }

            .danger {
                color: #ef4444;
                border-color: #fecaca;
            }

            .danger:hover:not(:disabled) {
                background: #fef2f2;
            }

            .status {
                background: #f9fafb;
                border: 1px solid #e5e5e5;
                border-radius: 8px;
                padding: 12px;
                font-size: 0.85rem;
                color: #404040;
            }

            #score-display {
                color: #000000 !important;
                border-color: #000000;
                background: #ffffff;
                font-weight: 600;
            }

            /* Wave Animation */
            .wave-container {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 4px;
                height: 30px;
                margin-bottom: 5px;
            }

            .bar {
                width: 4px;
                height: 10px;
                background: #000000;
                border-radius: 2px;
                animation: wave 0.6s infinite ease-in-out;
            }

            .bar:nth-child(2) {
                animation-delay: 0.1s;
            }
            .bar:nth-child(3) {
                animation-delay: 0.2s;
            }
            .bar:nth-child(4) {
                animation-delay: 0.3s;
            }
            .bar:nth-child(5) {
                animation-delay: 0.4s;
            }

            @keyframes wave {
                0%,
                100% {
                    height: 10px;
                }
                50% {
                    height: 30px;
                }
            }

            footer {
                color: #a3a3a3;
                font-size: 0.75rem;
                text-align: center;
                border-top: 1px solid #f5f5f5;
                padding-top: 20px;
                margin-top: auto;
            }

            /* Scrollbar */
            .chat-messages::-webkit-scrollbar,
            .control-panel::-webkit-scrollbar {
                width: 6px;
            }

            .chat-messages::-webkit-scrollbar-track,
            .control-panel::-webkit-scrollbar-track {
                background: transparent;
            }

            .chat-messages::-webkit-scrollbar-thumb,
            .control-panel::-webkit-scrollbar-thumb {
                background: #d4d4d4;
                border-radius: 10px;
            }

            .chat-messages::-webkit-scrollbar-thumb:hover,
            .control-panel::-webkit-scrollbar-thumb:hover {
                background: #a3a3a3;
            }

            /* Responsive */
            @media (max-width: 1024px) {
                .container {
                    flex-direction: column;
                    height: auto;
                }

                .control-panel {
                    width: 100%;
                }

                .chat-container {
                    height: 500px;
                }

                .message {
                    max-width: 90%;
                }
            }

            /* ========== PRODUCT CARDS ========== */
            .product-cards-wrapper {
                max-width: 100%;
                align-self: flex-start;
                animation: fadeIn 0.3s ease-in;
            }

            .product-cards-header {
                display: flex;
                align-items: center;
                gap: 8px;
                margin-bottom: 12px;
                padding-bottom: 8px;
                border-bottom: 1px solid #e5e5e5;
            }

            .product-cards-header-text {
                font-size: 0.85rem;
                font-weight: 600;
                color: #525252;
            }

            .product-cards-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
                width: 100%;
            }

            .product-card {
                background: #ffffff;
                border: 1px solid #e5e5e5;
                border-radius: 10px;
                overflow: hidden;
                transition: all 0.2s;
                cursor: pointer;
                width: 240px;
            }

            .product-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
                border-color: #000000;
            }

            .product-image {
                width: 100%;
                height: 140px;
                object-fit: cover;
                background: #f5f5f5;
            }

            .product-info {
                padding: 10px;
            }

            .product-category {
                display: inline-block;
                background: #f3f4f6;
                padding: 3px 8px;
                border-radius: 4px;
                font-size: 0.65rem;
                color: #525252;
                margin-bottom: 6px;
                font-weight: 500;
            }

            .product-name {
                font-size: 0.85rem;
                font-weight: 600;
                color: #1a1a1a;
                margin-bottom: 8px;
                display: -webkit-box;
                -webkit-line-clamp: 2;
                line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
                line-height: 1.3;
                min-height: 34px;
            }

            .product-meta {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-top: 8px;
            }

            .product-price {
                font-size: 0.95rem;
                font-weight: 700;
                color: #000000;
            }

            .product-rating {
                display: flex;
                align-items: center;
                gap: 3px;
                font-size: 0.75rem;
                color: #737373;
                font-weight: 500;
            }

            .product-stock {
                font-size: 0.7rem;
                margin-top: 6px;
                font-weight: 500;
            }

            .product-stock.in-stock {
                color: #10b981;
            }
            .product-stock.low-stock {
                color: #f59e0b;
            }
            .product-stock.out-of-stock {
                color: #ef4444;
            }

            @media (max-width: 768px) {
                .product-cards-grid {
                    grid-template-columns: 1fr;
                }
                .product-card {
                    width: 100%;
                }
            }
        </style>
    </head>

    <body>
        <div class="container">
            <!-- Control Panel (Sidebar) -->
            <div class="control-panel">
                <h2>üéôÔ∏è Voice Verification</h2>

                <form id="login-form">
                    <input
                        id="email"
                        type="email"
                        placeholder="Email"
                        autocomplete="email" />
                    <input
                        id="password"
                        type="password"
                        placeholder="Password"
                        autocomplete="current-password" />

                    <div class="btn-group">
                        <button type="submit" id="login-btn" class="primary">
                            Login
                        </button>
                        <button
                            type="button"
                            id="logout-btn"
                            class="danger"
                            disabled>
                            Logout
                        </button>
                    </div>
                </form>
                <form id="signup-form" style="margin-top: 16px">
                    <input
                        id="signup-email"
                        type="email"
                        placeholder="Email baru"
                        autocomplete="email"
                        required />

                    <input
                        id="signup-password"
                        type="password"
                        placeholder="Password (min 6 karakter)"
                        autocomplete="new-password"
                        required />

                    <button type="submit" class="primary">
                        üìù Daftar / Signup
                    </button>
                </form>

                <div class="section">
                    <div class="section-title">LiveKit Room</div>
                    <div class="btn-group">
                        <button id="join">Join Room</button>
                        <button id="leave" class="danger" disabled>
                            Leave
                        </button>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">Voice Enrollment</div>

                    <input
                        id="enroll-label"
                        type="text"
                        placeholder="Label suara (mis. default / mic1 / home)"
                        style="margin-bottom: 10px"
                        required />

                    <div class="btn-group">
                        <button id="enroll" class="primary">
                            Enroll Voice
                        </button>
                    </div>
                </div>

                <div
                    id="agent-anim"
                    style="
                        display: none;
                        text-align: center;
                        margin-bottom: 15px;
                    ">
                    <div class="wave-container">
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                    </div>
                    <small style="color: #737373; font-size: 0.8rem"
                        >Agent sedang berbicara...</small
                    >
                </div>

                <div class="section">
                    <div class="section-title">Status Verifikasi</div>
                    <div id="status-verify" class="status">üéß Status: Idle</div>
                    <div
                        id="score-display"
                        class="status"
                        style="margin-top: 8px; display: none">
                        üìä Score: 0%
                    </div>
                    <div
                        id="status-room"
                        class="status"
                        style="
                            margin-top: 8px;
                            font-size: 0.8rem;
                            opacity: 0.8;
                        ">
                        üåê Status room: Not connected
                    </div>
                </div>

                <footer>Voice Auth Demo ‚Ä¢ LiveKit</footer>
            </div>

            <!-- Chat Area -->
            <div class="chat-container">
                <div class="chat-header">
                    <span class="status-indicator" id="chat-status"></span>
                    <h2>üí¨ Percakapan dengan AI Assistant</h2>
                </div>
                <div class="chat-messages" id="chat-messages">
                    <div class="empty-state">
                        <div class="empty-state-icon">üí¨</div>
                        <div class="empty-state-text">Belum ada percakapan</div>
                        <div class="empty-state-subtext">
                            Join room dan mulai berbicara dengan AI assistant
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
        <script src="https://unpkg.com/livekit-client/dist/livekit-client.umd.js"></script>
        <script src="config.js"></script>
        <script src="app.js"></script>
    </body>
</html>
